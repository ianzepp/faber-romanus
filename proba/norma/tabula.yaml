# Tabula - Map/dictionary collection method codegen tests
# Covers: pone, accipe, habet, dele, longitudo, vacua, purga, claves, valores,
#         accipeAut, confla, inLista

# =============================================================================
# Core Operations
# =============================================================================

# pone inserts or updates a key-value pair
- name: 'pone -> insert_or_assign'
  input: |
      fixum tabula<textus, numerus> map = {}
      map.pone("key", 42)
  wrap: 'cura arena fit alloc { $ }'
  cpp:
      - '.insert_or_assign('
  ts:
      - '.set('
  rs:
      - 'HashMap<String, i64>'
      - '.insert('
  zig:
      - '.pone(alloc, "key", 42)'
  fab:
      - 'fixum tabula<textus, numerus> map = {}'
      - 'map.pone("key", 42)'

# accipe retrieves a value by key (throws if not found)
- name: 'accipe -> at'
  input: |
      fixum tabula<textus, numerus> map = {}
      map.accipe("key")
  cpp:
      - '.at('
  ts:
      - '.get('
  rs:
      - 'HashMap<String, i64>'
      - '.get(&String::from("key")'
  zig:
      - '.accipe("key")'
  fab:
      - 'fixum tabula<textus, numerus> map = {}'
      - 'map.accipe("key")'

# habet checks if key exists
- name: 'habet -> contains'
  input: |
      fixum tabula<textus, numerus> map = {}
      map.habet("key")
  cpp:
      - '.contains('
  ts:
      - '.has('
  rs:
      - 'HashMap<String, i64>'
      - '.contains_key(&String::from("key")'
  zig:
      - '.habet("key")'
  fab:
      - 'fixum tabula<textus, numerus> map = {}'
      - 'map.habet("key")'

# dele removes a key-value pair
- name: 'dele -> erase'
  input: |
      fixum tabula<textus, numerus> map = {}
      map.dele("key")
  cpp:
      - '.erase('
  ts:
      - '.delete('
  rs:
      - 'HashMap<String, i64>'
      - '.remove(&String::from("key")'
  zig:
      - '.dele("key")'
  fab:
      - 'fixum tabula<textus, numerus> map = {}'
      - 'map.dele("key")'

# longitudo returns the number of entries
- name: 'longitudo -> size'
  input: |
      fixum tabula<textus, numerus> map = {}
      map.longitudo()
  cpp:
      - '.size()'
  ts:
      - '.size'
  rs:
      - 'HashMap<String, i64>'
      - '.len()'
  zig:
      - '.longitudo()'
  fab:
      - 'fixum tabula<textus, numerus> map = {}'
      - 'map.longitudo()'

# vacua checks if the map is empty
- name: 'vacua -> empty'
  input: |
      fixum tabula<textus, numerus> map = {}
      map.vacua()
  cpp:
      - '.empty()'
  ts:
      - '.size === 0'
  rs:
      - 'HashMap<String, i64>'
      - '.is_empty()'
  zig:
      - '.vacua()'
  fab:
      - 'fixum tabula<textus, numerus> map = {}'
      - 'map.vacua()'

# purga clears the entire map
- name: 'purga -> clear'
  input: |
      varia tabula<textus, numerus> map = {}
      map.purga()
  cpp:
      - '.clear()'
  ts:
      - '.clear('
  rs:
      - 'HashMap<String, i64>'
      - '.clear()'
  zig:
      - '.purga()'
  fab:
      - 'varia tabula<textus, numerus> map = {}'
      - 'map.purga()'

# =============================================================================
# Iteration
# =============================================================================

# claves returns a view of all keys
- name: 'claves -> views::keys'
  input: |
      fixum tabula<textus, numerus> map = {}
      map.claves()
  cpp:
      - 'std::views::keys'
  ts:
      - '.keys('
  rs:
      - 'HashMap<String, i64>'
      - '.keys()'
  zig:
      - '.claves()'
  fab:
      - 'fixum tabula<textus, numerus> map = {}'
      - 'map.claves()'

# valores returns a view of all values
- name: 'valores -> views::values'
  input: |
      fixum tabula<textus, numerus> map = {}
      map.valores()
  cpp:
      - 'std::views::values'
  ts:
      - '.values('
  rs:
      - 'HashMap<String, i64>'
      - '.values()'
  zig:
      - '.valores()'
  fab:
      - 'fixum tabula<textus, numerus> map = {}'
      - 'map.valores()'

# =============================================================================
# Extended Methods
# =============================================================================

# accipeAut returns value if exists, otherwise default
- name: 'accipeAut -> contains + at with default'
  input: |
      fixum tabula<textus, numerus> map = {}
      map.accipeAut("key", 0)
  cpp:
      - '.contains('
      - '.at('
  ts:
      - '.get('
  rs:
      - 'HashMap<String, i64>'
      - '.get(&String::from("key")'
      - '.unwrap_or(0)'
  zig:
      - '.accipeAut("key", 0)'
  fab:
      - 'fixum tabula<textus, numerus> map = {}'
      - 'map.accipeAut("key", 0)'

# confla merges another map into this one
- name: 'confla -> merge maps'
  input: |
      fixum tabula<textus, numerus> map = {}
      fixum tabula<textus, numerus> other = {}
      map.confla(other)
  cpp:
      - 'for (auto& [k, v]'
  ts:
      - '[...'
  rs:
      - 'HashMap<String, i64>'
      - '.extend(other.iter()'
  fab:
      - 'fixum tabula<textus, numerus> map = {}'
      - 'fixum tabula<textus, numerus> other = {}'
      - 'map.confla(other)'

# inLista converts map entries to a vector
- name: 'inLista -> vector from map'
  input: |
      fixum tabula<textus, numerus> map = {}
      map.inLista()
  cpp:
      - 'std::vector('
  ts:
      - '[...'
  rs:
      - 'HashMap<String, i64>'
      - '.iter().map(|(k, v)| (k.clone(), v.clone())).collect::<Vec<_>>()'
  fab:
      - 'fixum tabula<textus, numerus> map = {}'
      - 'map.inLista()'
