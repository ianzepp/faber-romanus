# Errores - Error handling codegen tests
# Covers: tempta/cape/demum, iace/mori, fac blocks

# =============================================================================
# Try/Catch/Finally
# =============================================================================

# tempta/cape is try/catch (try/except in Python)
- name: 'tempta cape'
  input: |
      tempta {
        riskyCode()
      }
      cape error {
        handleError()
      }
  ts:
      - 'try {'
      - 'catch (error)'
  py:
      - 'try:'
      - 'except Exception as error:'
  cpp:
      - 'try {'
      - 'catch (const std::exception& error)'

# demum is finally - runs regardless of exception
- name: 'tempta with demum'
  input: |
      tempta {
        riskyCode()
      }
      cape error {
        handleError()
      }
      demum {
        cleanup()
      }
  ts:
      - 'try {'
      - 'finally {'
      - 'cleanup()'
  py:
      - 'try:'
      - 'finally:'
      - 'cleanup()'
  cpp:
      - 'try {'
      - 'catch (const std::exception& error)'
      - 'struct _ScopeGuard'
      - '~_ScopeGuard()'
      - '_ScopeGuard([&]{'
      - 'cleanup()'

# =============================================================================
# Throw (iace)
# =============================================================================

# iace with string literal - wraps in Error/Exception
- name: 'iace string'
  input: 'iace "error message"'
  ts:
      - 'throw'
      - 'error message'
  py:
      - 'raise Exception("error message")'
  cpp:
      - 'throw std::runtime_error'
  zig:
      - 'return error.ErrorMessage'

# iace with new Error - translates constructor
- name: 'iace with Error'
  input: 'iace novum Error("msg")'
  ts:
      - 'throw'
      - 'new Error'
  py:
      - 'raise Exception("msg")'
  zig:
      - 'return error.Msg'

# iace with variable - throws directly
- name: 'iace variable'
  input: 'iace err'
  ts:
      - 'throw'
      - 'err'
  py:
      - 'raise err'
  zig:
      - 'return error.Err'

# =============================================================================
# Panic (mori)
# =============================================================================

# mori is fatal error - Panic in TS, SystemExit in Python
- name: 'mori string'
  input: 'mori "something went wrong"'
  ts:
      - 'throw new Panic("something went wrong")'
  py:
      - 'raise SystemExit("something went wrong")'
  cpp:
      - '#include <cstdlib>'
      - 'std::print(stderr'
      - 'FATAL:'
      - 'std::abort()'
  zig:
      - '@panic("something went wrong")'

# =============================================================================
# Fac Block
# =============================================================================

# fac creates a bare block scope (no try wrapper)
- name: 'fac block bare'
  input: 'fac { varia x = 1 }'
  ts:
      - '{'
      - 'let x = 1'
  py:
      - 'x = 1'
  zig:
      - 'var x: i64 = 1;'

# fac with cape wraps in try/catch
- name: 'fac with cape'
  input: 'fac { x() } cape e { y() }'
  ts:
      - 'try {'
      - 'x()'
      - 'catch (e)'
      - 'y()'
  py:
      - 'try:'
      - 'x()'
      - 'except Exception as e:'
      - 'y()'
