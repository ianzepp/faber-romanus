# Array expressions - array literals and spread
# Maps Faber array syntax to target-language equivalents

- name: empty array
  source: fixum arr = []
  expect:
      ts: 'const arr = [];'
      py: 'arr = []'
      rs:
          - 'let arr = vec![];'
      cpp:
          - 'const auto arr = {};'
      zig:
          - 'const arr = .{};'
      fab:
          - 'fixum arr = []'

- name: array with elements
  source: fixum nums = [1, 2, 3]
  expect:
      ts: 'const nums = [1, 2, 3];'
      py: 'nums = [1, 2, 3]'
      rs:
          - 'let nums = vec![1, 2, 3];'
      cpp:
          - 'const auto nums = std::vector{1, 2, 3};'
      zig:
          - '.{ 1, 2, 3 }'
      fab:
          - 'fixum nums = [1, 2, 3]'

- name: array with string elements
  source: fixum names = ["a", "b", "c"]
  expect:
      ts: 'const names = ["a", "b", "c"];'
      py: 'names = ["a", "b", "c"]'
      rs:
          - 'let names = vec!["a", "b", "c"];'
      cpp:
          - 'std::vector{"a", "b", "c"}'
      zig:
          - '.{ "a", "b", "c" }'
      fab:
          - 'fixum names = ["a", "b", "c"]'

- name: spread in array
  source: fixum combined = [sparge a, sparge b]
  expect:
      ts: 'const combined = [...a, ...b];'
      py: 'combined = [*a, *b]'
      rs:
          - 'let combined = vec!'
      cpp:
          # TODO: C++ spread is broken - should expand a and b into combined
          - 'const auto combined = {};'
      fab:
          - 'fixum combined = ['
          - '...a'
          - '...b'

- name: deeply nested arrays (3 levels)
  source: fixum matrix = [[[1, 2], [3, 4]], [[5, 6], [7, 8]]]
  expect:
      ts: 'const matrix = [[[1, 2], [3, 4]], [[5, 6], [7, 8]]];'
      py: 'matrix = [[[1, 2], [3, 4]], [[5, 6], [7, 8]]]'
      rs:
          - 'let matrix = vec![vec![vec![1, 2], vec![3, 4]], vec![vec![5, 6], vec![7, 8]]];'
      cpp:
          - 'const auto matrix = std::vector{std::vector{std::vector{1, 2}, std::vector{3, 4}}, std::vector{std::vector{5, 6}, std::vector{7, 8}}};'
      zig:
          - '.{ .{ .{ 1, 2 }, .{ 3, 4 } }, .{ .{ 5, 6 }, .{ 7, 8 } } }'
      fab:
          - 'fixum matrix = [[[1, 2], [3, 4]], [[5, 6], [7, 8]]]'

- name: single element array
  source: fixum single = [42]
  expect:
      ts: 'const single = [42];'
      py: 'single = [42]'
      rs:
          - 'let single = vec![42];'
      cpp:
          - 'const auto single = std::vector{42};'
      zig:
          - '.{ 42 }'
      fab:
          - 'fixum single = [42]'

- name: spread in middle of array
  source: fixum arr = [1, sparge middle, 2]
  expect:
      ts: 'const arr = [1, ...middle, 2];'
      py: 'arr = [1, *middle, 2]'
      rs:
          - 'let arr = vec!'
      cpp:
          # TODO: C++ spread is broken - should be {1, ...middle, 2}
          - 'const auto arr = {};'
      zig:
          - '.{ 1, middle, 2 }'
      fab:
          - 'fixum arr = ['
          - '...middle'

- name: spread with function call
  source: fixum arr = [sparge getItems(), 99]
  expect:
      ts: 'const arr = [...getItems(), 99];'
      py: 'arr = [*getItems(), 99]'
      rs:
          - 'let arr = vec!'
      cpp:
          # TODO: C++ spread is broken - should expand getItems() result
          - 'const auto arr = {};'
      zig:
          - '.{ getItems(), 99 }'
      fab:
          - 'fixum arr = ['
          - '...getItems()'
          - '99'

- name: mixed types in array
  source: fixum mixed = [1, "text", verum, nihil]
  skip: [cpp, rs, zig] # These targets don't support mixed-type arrays
  expect:
      ts: 'const mixed = [1, "text", true, null];'
      py: 'mixed = [1, "text", True, None]'
      fab:
          - 'fixum mixed = [1, "text", verum, nihil]'

- name: array with trailing comma
  source: fixum arr = [1, 2, 3,]
  expect:
      ts: 'const arr = [1, 2, 3];'
      py: 'arr = [1, 2, 3]'
      rs:
          - 'let arr = vec![1, 2, 3];'
      cpp:
          - 'const auto arr = std::vector{1, 2, 3};'
      zig:
          - '.{ 1, 2, 3 }'
      fab:
          - 'fixum arr = [1, 2, 3]'

- name: nested spread
  source: fixum arr = [[sparge inner], outer]
  expect:
      ts: 'const arr = [[...inner], outer];'
      py: 'arr = [[*inner], outer]'
      rs:
          - 'let arr = vec!'
      cpp:
          # TODO: C++ spread is broken - should expand inner into nested array
          - 'const auto arr = {};'
      zig:
          - '.{ .{ inner }, outer }'
      fab:
          - 'fixum arr = ['
          - '[...inner]'
          - 'outer'

- name: array of arrays
  source: fixum grid = [[1, 2], [3, 4], [5, 6]]
  expect:
      ts: 'const grid = [[1, 2], [3, 4], [5, 6]];'
      py: 'grid = [[1, 2], [3, 4], [5, 6]]'
      rs:
          - 'let grid = vec![vec![1, 2], vec![3, 4], vec![5, 6]];'
      cpp:
          - 'const auto grid = std::vector{std::vector{1, 2}, std::vector{3, 4}, std::vector{5, 6}};'
      zig:
          - '.{ .{ 1, 2 }, .{ 3, 4 }, .{ 5, 6 } }'
      fab:
          - 'fixum grid = [[1, 2], [3, 4], [5, 6]]'

- name: large array (many elements)
  source: fixum nums = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
  expect:
      ts: 'const nums = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];'
      py: 'nums = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]'
      rs:
          - 'let nums = vec![1, 2, 3, 4, 5, 6, 7, 8, 9, 10];'
      cpp:
          - 'const auto nums = std::vector{1, 2, 3, 4, 5, 6, 7, 8, 9, 10};'
      zig:
          - '.{ 1, 2, 3, 4, 5, 6, 7, 8, 9, 10 }'
      fab:
          - 'fixum nums = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]'
