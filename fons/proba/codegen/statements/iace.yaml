# Throw statements - iace/mori
# Maps Faber throw syntax to target-language error handling
#
# Syntax:
#   iace expression  -- throws recoverable error (can be caught)
#   mori expression  -- throws fatal error (panic/unrecoverable)
#
# Target mappings:
#   ts:  iace -> throw, mori -> throw new Panic()
#   py:  iace -> raise Exception, mori -> raise SystemExit
#   rs:  iace -> return Err(), mori -> panic!()
#   cpp: iace -> throw runtime_error, mori -> abort()
#   zig: iace -> return error.X, mori -> @panic()

# =============================================================================
# Recoverable Errors (iace)
# =============================================================================

# Throw string literal
- name: throw string literal
  source: 'iace "error occurred"'
  expect:
      ts:
          - 'throw "error occurred";'
      py:
          - 'raise Exception("error occurred")'
      rs:
          - 'return Err(String::from("error occurred"));'
      cpp:
          - 'throw std::runtime_error("error occurred");'
      zig:
          - 'return error.ErrorOccurred;'
      fab:
          - 'iace "error occurred"'

# Throw variable
- name: throw variable
  source: 'iace err'
  expect:
      ts:
          - 'throw err;'
      py:
          - 'raise err'
      rs:
          - 'return Err(err);'
      cpp:
          - 'throw err;'
      zig:
          - 'return error.Err;'
      fab:
          - 'iace err'

# =============================================================================
# Fatal Errors (mori)
# =============================================================================

# Panic with string literal
- name: panic with string literal
  source: 'mori "fatal error"'
  expect:
      ts:
          - 'throw new Panic("fatal error");'
      py:
          - 'raise SystemExit("fatal error")'
      rs:
          - 'panic!(String::from("fatal error"));'
      cpp:
          - 'std::print(stderr, "FATAL: {}\n", "fatal error"); std::abort();'
      zig:
          - '@panic("fatal error");'
      fab:
          - 'mori "fatal error"'

# Panic with variable
- name: panic with variable
  source: 'mori msg'
  expect:
      ts:
          - 'throw new Panic(String(msg));'
      py:
          - 'raise SystemExit(msg)'
      rs:
          - 'panic!(msg);'
      cpp:
          - 'std::print(stderr, "FATAL: {}\n", msg); std::abort();'
      zig:
          - '@panic(msg);'
      fab:
          - 'mori msg'

# =============================================================================
# Edge Cases
# =============================================================================

# Throw with Error constructor
- name: throw with error constructor
  source: 'iace novum Error("message")'
  expect:
      ts:
          - 'throw new Error("message");'
      py:
          - 'raise Exception("message")'
      fab:
          - 'iace novum Error("message")'

# Throw with template message
- name: throw with template message
  source: 'iace `Failed to process ${item.id}`'
  expect:
      ts:
          - 'throw `Failed to process ${item.id}`;'
      py:
          - 'raise f"Failed to process {item.id}"'
      fab:
          - 'iace `Failed to process ${item.id}`'

# Throw in conditional
- name: throw in conditional
  source: |
      si nihil data { iace "Data required" }
  expect:
      ts:
          - 'if ((data == null)) {'
          - 'throw "Data required";'
          - '}'
      py:
          - 'if (data is None):'
          - 'raise Exception("Data required")'
      fab:
          - 'si nihil data {'
          - 'iace "Data required"'
          - '}'

# Panic with template
- name: panic with template message
  source: 'mori `Critical failure at ${location}`'
  expect:
      ts:
          - 'throw new Panic(String(`Critical failure at ${location}`));'
      py:
          - 'raise SystemExit(f"Critical failure at {location}")'
      fab:
          - 'mori `Critical failure at ${location}`'

# Throw with variable (explicit edge case)
- name: throw error message variable
  source: 'iace errorMessage'
  expect:
      ts:
          - 'throw errorMessage;'
      py:
          - 'raise errorMessage'
      fab:
          - 'iace errorMessage'

# Throw with concatenated message
- name: throw concatenated message
  source: 'iace "Error: " + message'
  expect:
      ts:
          - 'throw ("Error: " + message);'
      py:
          - 'raise ("Error: " + message)'
      fab:
          - 'iace "Error: " + message'
