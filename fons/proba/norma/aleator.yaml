# File-level metadata: skip in rivus tests (stdlib not yet implemented)
- rivus: false

# Aleator - Random stdlib functions
# Tests for norma/aleator module functions

# =============================================================================
# Basic Generation
# =============================================================================

- name: fractus (random float 0-1)
  source: |
      fixum x = fractus()
  expect:
      ts: 'const x = Math.random();'
      py:
          - 'import random'
          - 'x = random.random()'
      cpp:
          - '#include <random>'
          - 'std::random_device rd'
          - 'std::mt19937 gen(rd())'
          - 'std::uniform_real_distribution<> dis(0.0, 1.0)'
      rs:
          - 'let x = rand::random::<f64>();'
      zig:
          - 'std.rand.DefaultPrng'
          - '.float(f64)'

- name: inter (random integer in range)
  source: |
      fixum x = inter(1, 100)
  expect:
      ts:
          - 'const x = Math.floor(Math.random() * (100 - 1 + 1)) + 1;'
      py:
          - 'import random'
          - 'x = random.randint(1, 100)'
      cpp:
          - '#include <random>'
          - 'std::uniform_int_distribution<> dis(1, 100)'
      rs:
          - 'let x = rand::thread_rng().gen_range(1..=100);'
      zig:
          - 'std.rand.DefaultPrng'
          - 'intRangeAtMost(i64, 1, 100)'

- name: octeti (random bytes)
  source: |
      fixum bytes = octeti(16)
  expect:
      ts: 'const bytes = crypto.getRandomValues(new Uint8Array(16));'
      py:
          - 'import secrets'
          - 'bytes = secrets.token_bytes(16)'
      cpp:
          - '#include <random>'
          - '#include <vector>'
          - 'std::vector<uint8_t> bytes(16)'
          - 'std::random_device rd'
      rs:
          - 'let bytes = { let mut bytes = vec![0u8; 16]'
          - 'rand::thread_rng().fill(&mut bytes[..])'
      zig:
          - 'std.crypto.random.bytes'

- name: uuid (UUID v4)
  source: |
      fixum id = uuid()
  expect:
      ts: 'const id = crypto.randomUUID();'
      py:
          - 'import uuid'
          - 'id = str(uuid.uuid4())'
      cpp:
          - '#include <random>'
          - '#include <string>'
          - 'std::string uuid'
      rs:
          - 'let id = uuid::Uuid::new_v4().to_string();'
      zig:
          - 'std.crypto.random.bytes'
          - 'var buf: [36]u8'

# =============================================================================
# Collection Operations
# =============================================================================

- name: selige (random pick from list)
  source: |
      fixum items = [1, 2, 3, 4, 5]
      fixum item = selige(items)
  expect:
      ts:
          - 'const items = [1, 2, 3, 4, 5];'
          - 'const item = items[Math.floor(Math.random() * items.length)];'
      py:
          - 'import random'
          - 'items = [1, 2, 3, 4, 5]'
          - 'item = random.choice(items)'
      cpp:
          - '#include <random>'
          - 'std::uniform_int_distribution<size_t> dis(0, items.size() - 1)'
      rs:
          - 'let items = vec![1, 2, 3, 4, 5];'
          - 'let item = items.choose(&mut rand::thread_rng()).unwrap().clone();'
      zig:
          - 'std.rand.DefaultPrng'
          - 'uintLessThan(usize, items.len)'

- name: misce (shuffle list)
  source: |
      fixum items = [1, 2, 3, 4, 5]
      fixum shuffled = misce(items)
  expect:
      ts:
          contains:
              - 'const items = [1, 2, 3, 4, 5];'
              - 'const shuffled'
              - 'const a = [...items]'
              - 'Math.random()'
              - 'return a'
      py:
          - 'import random'
          - 'items = [1, 2, 3, 4, 5]'
          - 'shuffled = random.sample(items, len(items))'
      cpp:
          - '#include <random>'
          - '#include <algorithm>'
          - 'auto v = items'
          - 'std::ranges::shuffle(v, gen)'
      rs:
          - 'let items = vec![1, 2, 3, 4, 5];'
          - 'let shuffled = { let mut v = items.clone(); v.shuffle(&mut rand::thread_rng()); v };'
      zig:
          - 'std.rand.DefaultPrng'
          - '.shuffle'

# =============================================================================
# Seeding
# =============================================================================

- name: semen (seed RNG)
  source: |
      semen(42)
  expect:
      ts:
          - 'undefined /* JS Math.random is not seedable */'
      py:
          - 'import random'
          - 'random.seed(42)'
      cpp:
          - 'seed(42)'
          - 'C++ requires explicit generator management'
      rs:
          - 'seed(42)'
          - 'rand::SeedableRng'
      zig:
          - 'seed(42)'
          - 'Zig requires explicit PRNG state management'

# =============================================================================
# Combined Usage
# =============================================================================

- name: random dice roll
  source: |
      fixum die1 = inter(1, 6)
      fixum die2 = inter(1, 6)
      fixum total = die1 + die2
  expect:
      ts:
          - 'const die1 = Math.floor(Math.random() * (6 - 1 + 1)) + 1;'
          - 'const die2 = Math.floor(Math.random() * (6 - 1 + 1)) + 1;'
          - 'const total = (die1 + die2);'
      py:
          - 'import random'
          - 'die1 = random.randint(1, 6)'
          - 'die2 = random.randint(1, 6)'
          - 'total = (die1 + die2)'
      cpp:
          - '#include <random>'
          - 'std::uniform_int_distribution<> dis(1, 6)'
          - 'const auto die1'
          - 'const auto die2'
          - 'const auto total = (die1 + die2)'
      rs:
          - 'let die1 = rand::thread_rng().gen_range(1..=6);'
          - 'let die2 = rand::thread_rng().gen_range(1..=6);'
          - 'let total = (die1 + die2);'
      zig:
          - 'std.rand.DefaultPrng'
          - 'intRangeAtMost(i64, 1, 6)'
          - 'const total'
